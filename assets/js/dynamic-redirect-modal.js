(()=>{function n(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var a,l,i,r,c=[],o=!0,s=!1;try{if(i=(t=t.call(n)).next,0===e){if(Object(t)!==t)return;o=!1}else for(;!(o=(a=i.call(t)).done)&&(c.push(a.value),c.length!==e);o=!0);}catch(n){s=!0,l=n}finally{try{if(!o&&null!=t.return&&(r=t.return(),Object(r)!==r))return}finally{if(s)throw l}}return c}}(n,t)||function(n,t){if(n){if("string"==typeof n)return e(n,t);var a={}.toString.call(n).slice(8,-1);return"Object"===a&&n.constructor&&(a=n.constructor.name),"Map"===a||"Set"===a?Array.from(n):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(n,t):void 0}}(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,a=Array(e);t<e;t++)a[t]=n[t];return a}!function(e){"use strict";var t={country:{label:"Country",multiSelect:!0,options:linkcentral_data.countries,maxInstances:1},device:{label:"Device",multiSelect:!0,options:{desktop:"Desktop",mobile:"Mobile",tablet:"Tablet"},maxInstances:1},date:{label:"Date",multiSelect:!1,inputType:"date",maxInstances:1},time:{label:"Time",multiSelect:!1,inputType:"time",maxInstances:1}},a={is:"is",is_not:"is not",is_before:"is before",is_after:"is after",is_on:"is on",is_between:"is between",is_not_between:"is not between"},l="1"===linkcentral_data.can_use_premium_code__premium_only;e(document).ready((function(){var i=e("#linkcentral-dynamic-redirect-modal"),r=e("#linkcentral-dynamic-redirect"),c=e(".linkcentral-modal-close"),o=e("#linkcentral-rules-container"),s=e("#linkcentral-add-rule"),u=e("#linkcentral-save-rules"),d=0;function v(){i.hide()}function k(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e("#linkcentral-no-rules-message").remove(),e("#linkcentral-static-rule").remove();var a=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return'\n                <div class="linkcentral-rule" data-rule-id="'.concat(n,'">\n                    <div class="linkcentral-rule-header">\n                        <h4 class="rule-number">Rule ').concat(n,'</h4>\n                        <button class="linkcentral-remove-rule button button-secondary">Remove Rule</button>\n                    </div>\n                    <div class="linkcentral-rule-content">\n                        <div class="linkcentral-variables-container">\n                            ').concat(f(!0,n),'\n                        </div>\n                        <button class="linkcentral-add-variable button button-secondary">Add Variable</button>\n                    </div>\n                    <div class="linkcentral-destination-container">\n                        <label for="linkcentral-rule-destination-').concat(n,'">Go to Destination URL:</label>\n                        <input type="url" id="linkcentral-rule-destination-').concat(n,'" class="linkcentral-rule-destination" name="destination" placeholder="Enter the destination URL" value="').concat(e.destination||"https://",'">\n                    </div>\n                </div>\n            ')}(++d,n);if(o.append(a),n.variables){var l=o.find('.linkcentral-rule[data-rule-id="'.concat(d,'"]'));n.variables.forEach((function(n,a){a>0&&l.find(".linkcentral-add-variable").click();var i=l.find(".linkcentral-variable-container").eq(a);i.find(".linkcentral-variable-type").val(n[0]).change(),function(n,a){if(t[a[0]].multiSelect)n.find('.linkcentral-multi-select-dropdown input[type="checkbox"]').each((function(){e(this).prop("checked",a[2].includes(this.value))})),y.call(n.find('.linkcentral-multi-select-dropdown input[type="checkbox"]').first());else if("date"===a[0]||"time"===a[0]){var l=a[1];n.find(".linkcentral-condition").val(l).trigger("change"),"is between"!==l&&"is not between"!==l||!Array.isArray(a[2])?n.find(".linkcentral-".concat(a[0],"-start")).val(a[2]):(n.find(".linkcentral-".concat(a[0],"-start")).val(a[2][0]),n.find(".linkcentral-".concat(a[0],"-end")).val(a[2][1]))}else n.find(".linkcentral-variable-value").val(a[2]);a[1]&&n.find(".linkcentral-condition").val(a[1])}(i,n)}))}b(),h(),m(d)}function f(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0,l=Object.entries(t).map((function(e){var t=n(e,2),a=t[0],l=t[1].label;return'<option value="'.concat(a,'">').concat(l,"</option>")})).join("");return'\n                <div class="linkcentral-variable-container '.concat(e?"first-variable":"",'">\n                    <div class="linkcentral-variable-type-column">\n                        <span class="linkcentral-condition-label">').concat(e?"IF":"AND",'</span>\n                        <select class="linkcentral-variable-type" data-rule-id="').concat(a,'">\n                            <option value="">Select Variable</option>\n                            ').concat(l,'\n                        </select>\n                    </div>\n                    <div class="linkcentral-variable-value-column">\n                        <span class="linkcentral-variable-value-container"></span>\n                    </div>\n                    ').concat(e?"":'\n                        <div class="linkcentral-variable-remove-column">\n                            <button class="linkcentral-remove-variable button button-secondary">\n                                <span class="dashicons dashicons-trash"></span>\n                            </button>\n                        </div>\n                    ',"\n                </div>\n            ")}function p(n){try{return new URL(n),!0}catch(n){return!1}}function b(){e(".linkcentral-rule:not(.linkcentral-static-rule)").each((function(n){e(this).find(".rule-number").text("Rule ".concat(n+1)),e(this).attr("data-rule-id",n+1)})),d=e(".linkcentral-rule:not(.linkcentral-static-rule)").length}function h(){0===e(".linkcentral-rule:not(.linkcentral-static-rule)").length?(e("#linkcentral-no-rules-message").remove(),e("#linkcentral-static-rule").remove(),e("#linkcentral-rules-container").append('<p id="linkcentral-no-rules-message">No rules set yet. Click "Add Rule" to create a new rule.</p>')):(e("#linkcentral-no-rules-message").remove(),0===e("#linkcentral-static-rule").length&&e("#linkcentral-rules-container").append('\n                <div id="linkcentral-static-rule" class="linkcentral-rule linkcentral-static-rule">\n                    <div class="linkcentral-rule-header">\n                        <h4 class="rule-number">Default Rule</h4>\n                    </div>\n                    <div class="linkcentral-rule-content">\n                        <p>If none of the above rules are met, the default Destination URL will be used.</p>\n                    </div>\n                </div>\n            '))}function m(n){var a=e('.linkcentral-rule[data-rule-id="'.concat(n,'"]')),l=a.find(".linkcentral-variable-type").map((function(){return e(this).val()})).get().reduce((function(n,e){return n[e]=(n[e]||0)+1,n}),{});a.find(".linkcentral-variable-type").each((function(){var n=e(this).val();e(this).find("option").each((function(){if(this.value){var a=l[this.value]||0,i=t[this.value].maxInstances,r=a>=i&&this.value!==n;e(this).prop("disabled",r);var c=t[this.value].label;r?e(this).text("".concat(c," (max ").concat(i,")")):e(this).text(c)}}))}))}function y(){var n=e(this).closest(".linkcentral-multi-select-dropdown"),t=n.siblings(".linkcentral-multi-select-input"),a=n.find('input[type="checkbox"]:checked').map((function(){return e(this).parent().text().trim()})).get();t.val(a.join(", "))}function g(){var n=e("#linkcentral-dynamic-redirect"),t=JSON.parse(e("#linkcentral_dynamic_rules").val()||"[]");n.toggleClass("rules-set",t.length>0)}r.on("click",(function(n){var t;n.preventDefault(),i.show(),l?(t=JSON.parse(e("#linkcentral_dynamic_rules").val()||"[]"),o.empty(),d=0,t&&t.length>0&&t.forEach(k),h(),e("#linkcentral-add-rule, #linkcentral-save-rules").show()):(e("#linkcentral-rules-container").empty(),e("#linkcentral-add-rule, #linkcentral-save-rules").hide())})),c.on("click",v),e(window).on("click",(function(n){n.target===i[0]&&v()})),l&&(s.on("click",(function(n){n.preventDefault(),k()})),u.on("click",(function(n){if(n.preventDefault(),n.stopPropagation(),l){var a=!1,i=[],r=!0;e(".linkcentral-rule:not(.linkcentral-static-rule)").each((function(){var n=e(this),l={variables:[],destination:n.find(".linkcentral-rule-destination").val().trim()};n.find(".linkcentral-rule-error").remove();var c=new Set;n.find(".linkcentral-variable-container").each((function(){var n=e(this).find(".linkcentral-variable-type").val(),i=e(this).find(".linkcentral-condition").val(),o=function(n){var e=n.find(".linkcentral-variable-type").val(),a=t[e];if(!a)return"";if(a.multiSelect)return n.find('.linkcentral-multi-select-dropdown input[type="checkbox"]:checked').map((function(){return this.value})).get();if("date"===e||"time"===e){var l=n.find(".linkcentral-condition").val(),i=n.find(".linkcentral-".concat(e,"-start")).val(),r=n.find(".linkcentral-".concat(e,"-end")).val();return"is between"===l||"is not between"===l?[i,r]:i}return n.find(".linkcentral-variable-value").val()}(e(this));!n||Array.isArray(o)&&0===o.length||!Array.isArray(o)&&!o?(r=!1,c.add("One or more variables are incomplete.")):(l.variables.push([n,i,o]),"country"!==n||linkcentral_data.geolocation_service&&"none"!==linkcentral_data.geolocation_service||a||(alert("Warning: you have used a Country variable, but no geolocation service is set in the plugin settings. Please set a service first."),a=!0))})),l.destination?p(l.destination)||(r=!1,c.add("Invalid Destination URL.")):(r=!1,c.add("Destination URL is required.")),c.size>0&&n.append('<div class="linkcentral-rule-error">'.concat(Array.from(c).join("<br>"),"</div>")),l.variables.length>0&&p(l.destination)&&i.push(l)})),r&&(e("#linkcentral_dynamic_rules").val(JSON.stringify(i)),v(),g())}else alert("Dynamic Redirects are only available in the premium version.")}))),o.on("change",".linkcentral-variable-type",(function(){var l=e(this).closest(".linkcentral-variable-container").find(".linkcentral-variable-value-container"),i=e(this).closest(".linkcentral-variable-container").find(".linkcentral-remove-variable"),r=e(this).val(),c=e(this).data("rule-id");if(l.empty(),r?(i.show(),l.html(function(e){var l=t[e];if(!l)return"";var i=function(n){var e;switch(n){case"country":case"device":e=[a.is,a.is_not];break;case"date":e=[a.is_before,a.is_after,a.is_on,a.is_between,a.is_not_between];break;case"time":e=[a.is,a.is_before,a.is_after,a.is_between,a.is_not_between];break;default:e=Object.values(a)}return'\n                <select class="linkcentral-condition">\n                    '.concat(e.map((function(n){return'<option value="'.concat(n,'">').concat(n,"</option>")})).join(""),"\n                </select>\n            ")}(e),r="";return l.multiSelect?r=function(e,t){var a=Object.entries(t).map((function(e){var t=n(e,2),a=t[0],l=t[1];return'<label><input type="checkbox" value="'.concat(a,'"> ').concat(l,"</label>")})).join("");return'\n                <div class="linkcentral-multi-select">\n                    <input type="text" class="linkcentral-multi-select-input" readonly placeholder="Select '.concat(e,'">\n                    <div class="linkcentral-multi-select-dropdown" style="display:none;">\n                        ').concat(a,"\n                    </div>\n                </div>\n            ")}(e,l.options):l.inputType&&(r="date"===e||"time"===e?'\n                        <input type="'.concat(l.inputType,'" class="linkcentral-variable-value linkcentral-').concat(e,'-start">\n                        <span class="linkcentral-').concat(e,'-separator" style="display:none;"> and </span>\n                        <input type="').concat(l.inputType,'" class="linkcentral-variable-value linkcentral-').concat(e,'-end" style="display:none;">\n                    '):'<input type="'.concat(l.inputType,'" class="linkcentral-variable-value">')),'\n                <div class="linkcentral-input-group">\n                    '.concat(i,"\n                    ").concat(r,"\n                </div>\n            ")}(r)),m(c)):i.hide(),"date"===r||"time"===r){var o=l.find(".linkcentral-condition"),s=(l.find(".linkcentral-".concat(r,"-start")),l.find(".linkcentral-".concat(r,"-separator"))),u=l.find(".linkcentral-".concat(r,"-end"));o.on("change",(function(){"is between"===e(this).val()||"is not between"===e(this).val()?(s.show(),u.show()):(s.hide(),u.hide())}))}})).on("click",".linkcentral-add-variable",(function(n){n.preventDefault();var t=e(this).closest(".linkcentral-rule").data("rule-id");e(this).before(f(!1,t)),m(t)})).on("click",".linkcentral-remove-variable",(function(){var n=e(this).closest(".linkcentral-variable-container"),t=n.find(".linkcentral-variable-type").data("rule-id");n.hasClass("first-variable")||(n.remove(),m(t))})).on("click",".linkcentral-remove-rule",(function(){e(this).closest(".linkcentral-rule").remove(),b(),h()})),e(document).on("click",".linkcentral-multi-select-input",(function(n){n.stopPropagation();var t=e(this).siblings(".linkcentral-multi-select-dropdown");e(".linkcentral-multi-select-dropdown").not(t).hide(),t.toggle()})).on("change",'.linkcentral-multi-select-dropdown input[type="checkbox"]',y).on("click",(function(n){e(n.target).closest(".linkcentral-multi-select").length||e(".linkcentral-multi-select-dropdown").hide()})),g()}))}(jQuery)})();